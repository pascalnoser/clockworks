---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/",
  out.width = "100%"
)
library(badger)
```

# clockworks

<!-- badges: start -->
`r badge_lifecycle("experimental")`
`r badge_devel("pascalnoser/clockworks", "blue")`
`r badge_code_size("pascalnoser/clockworks")`
<!-- badges: end -->

<img src="man/figures/clockworks_logo_v1.png" width="200" align="right"/>

> clockworks is an R package for streamlined rhythmicity detection in time-series data. It serves as a wrapper for several popular analysis tools, eliminating the need to wrangle data into tool-specific formats or learn each methodâ€™s quirks. With simple, consistent inputs, clockworks can automatically adjust parameters based on the input data and prevent the use of methods not suited to a given dataset. In just a few lines of code, the user can easily run multiple methods, compare results, and generate basic visualizations.

***

## Installation

You can install the development version of clockworks from GitHub with:

``` r
# install.packages("pak")
pak::pak("pascalnoser/clockworks")
```

## Usage

Detecting rhythmic features using your method of choice is very straightforward. In the example below, we will use a synthetic data set of two rhythmic and eight non-rhythmic genes and the [MetaCycle](https://github.com/gangwug/MetaCycle) implementation of the [JTK_CYCLE](https://doi.org/10.1177/0748730410379711) method:

```{r example}
library(clockworks)

# Load example data and meta data
data("cw_data")
data("cw_metadata")

# Run rhythmicity detection with JTK_CYCLE
clockworks_results <- clockworks(
  dataset = cw_data,
  metadata = cw_metadata,
  colname_sample = "Sample_ID",
  colname_time = "Time",
  colname_group = "Group",
  method = "JTK_CYCLE",
  log_transformed = TRUE
)

# Show formatted output
head(clockworks_results$res_formatted)
```

The column names in the formatted output follow the same pattern for all methods. Furthermore, the results of a harmonic regression are also included in this output, allowing for a quick comparison of the estimated parameters to those of a simple sine wave fit. The harmonic regression used is equivalent to the model $y = M + A \sin(\frac{2 \pi}{P}(t + \phi))$ with $M$ the mesor, $A$ the amplitude, $t$ the time (e.g. in hours), and $P$ and $\phi$ the period and phase in the same units as $t$.
