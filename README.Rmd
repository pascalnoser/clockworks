---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/",
  out.width = "100%"
)
library(badger)
```

# clockworks

<!-- badges: start -->
`r badge_lifecycle("experimental")`
`r badge_devel("pascalnoser/clockworks", "blue")`
`r badge_code_size("pascalnoser/clockworks")`
<!-- badges: end -->

<img src="man/figures/clockworks_logo_v2.png" width="150" align="right"/>

> clockworks is an R package for streamlined rhythmicity detection in time-series data. It serves as a wrapper for several popular analysis tools, eliminating the need to wrangle data into tool-specific formats or learn each methodâ€™s quirks. With simple, consistent inputs, clockworks can automatically adjust parameters based on the input data and prevent the use of methods not suited to a given dataset. In just a few lines of code, the user can easily run multiple methods, compare results, and generate basic visualizations.

***

## Installation

You can install the development version of clockworks from GitHub with:

``` r
# install.packages("pak")
pak::pak("pascalnoser/clockworks")
```

## Usage

Detecting rhythmic features using your method of choice is very straightforward. In the example below, we will use a synthetic data set of two rhythmic and eight non-rhythmic genes. We will analyse them using [RAIN](https://www.bioconductor.org/packages/release/bioc/html/rain.html) as well as the [MetaCycle](https://github.com/gangwug/MetaCycle) implementation the [JTK_CYCLE](https://doi.org/10.1177/0748730410379711):

```{r example}
library(clockworks)

# Load example data and meta data
data("cw_data")
data("cw_metadata")

# The input data is a matrix or data frame with feature IDs as row names
print(cw_data[1:5, 1:5])

# The meta data requires a column with sample IDs corresponding to 
# the row names of the data and a column containing the time
print(head(cw_metadata))

# Create CircadianData object with default period of 24 hours
cd = CircadianData(
  dataset = cw_data,
  metadata = cw_metadata,
  colname_sample = "Sample_ID",
  colname_time = "Time",
  colname_group = "Group"
)

# Look at object before running analysis
print(cd)

# Run analysis using RAIN
cd = clockworks(cd, method = "RAIN")
# Run analysis using JTK_CYCLE
cd = clockworks(cd, method = "JTK_CYCLE")

# Extract formatted (standardised) results
res = get_results(cd)
head(res$RAIN)
head(res$JTK_CYCLE)
```

The column names in the formatted output follow the same pattern for all methods. Furthermore, the results of a harmonic regression are also included in this output, allowing for a quick comparison of the estimated parameters to those of a simple sine wave fit. The harmonic regression used is equivalent to the model $y = M + A \cos(\frac{2 \pi}{T}(t - \varphi))$ with $M$ the mesor, $A$ the amplitude, $t$ the time (e.g. in hours), and $T$ and $\phi$ the period and phase in the same units as $t$. This model was chosen because the value of $\varphi$ corresponds to the time point of the peak of the fitted wave.
